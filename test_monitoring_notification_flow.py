#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุฎุชุจุงุฑ ุชุฏูู ุงูุฅุดุนุงุฑุงุช ุงูุขููุฉ ูููุฑุงูุจุฉ
"""

import random
from datetime import datetime

def simulate_ai_analysis_failure():
    """ูุญุงูุงุฉ ูุดู ุชุญููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู"""
    print("๐ค ูุญุงูุงุฉ ุณููุงุฑูู ูุดู ุชุญููู AI")
    print("=" * 40)
    
    # ูุฐุง ูุง ูุญุฏุซ ุนูุฏ ูุดู ุชุญููู Gemini AI
    fresh_analysis = None  # ูุดู ูู ุงูุชุญููู
    
    # ุงูุชุญููู ุงูุงุญุชูุงุทู (ููุง ูู ุงูุณุทุฑ 8015-8024 ูู ุงูููุฏ ุงูุฃุตูู)
    success_rate = 34.0  # ูููุฉ ุงูุชุฑุงุถูุฉ ูุญุชููุฉ
    
    analysis = {
        'action': 'BUY',
        'confidence': success_rate,
        'reasoning': [f'ุฅุดุนุงุฑ ุชุฏุงูู ุขูู ููุฑูุฒ EURUSD'],
        'ai_analysis': f'ุฅุดุนุงุฑ ุชุฏุงูู ุขูู - ูุณุจุฉ ุงููุฌุงุญ {success_rate:.1f}%',
        'source': 'MT5 + Gemini AI',
        'symbol': 'EURUSD',
        'timestamp': datetime.now(),
        'price_data': {'last': 1.0500}
    }
    
    print(f"ุงููุชูุฌุฉ: {success_rate}%")
    print(f"ุงูุชุญููู ุงูุงุญุชูุงุทู: {analysis}")
    
    return analysis

def simulate_confidence_extraction_issue():
    """ูุญุงูุงุฉ ูุดููุฉ ูู ุงุณุชุฎุฑุงุฌ ูุณุจุฉ ุงูุซูุฉ ูู AI"""
    print("\n๐ ูุญุงูุงุฉ ูุดููุฉ ุงุณุชุฎุฑุงุฌ ูุณุจุฉ ุงูุซูุฉ")
    print("=" * 40)
    
    # ูุต ุชุญููู AI ูุฏ ูุญุชูู ุนูู ูุดุงูู
    ai_texts = [
        "ุชุญููู ููู ููุฒูุฌ ูุน ุฅุดุงุฑุฉ ูุชูุณุทุฉ",  # ูุง ูุญุชูู ุนูู ูุณุจุฉ
        "ุงูุงุชุฌุงู ุงูุนุงู ุฅูุฌุงุจู ูููู ููุงู ูุฎุงุทุฑ",  # ูุง ูุญุชูู ุนูู ูุณุจุฉ
        "ูุณุจุฉ ุงููุฌุงุญ: ุบูุฑ ูุญุฏุฏุฉ",  # ูุณุจุฉ ุบูุฑ ุฑูููุฉ
        "ุชุญููู ูุนูุฏ ุจุฏูู ูุชูุฌุฉ ูุงุถุญุฉ",  # ูุง ูุญุชูู ุนูู ูุณุจุฉ
        "ุฅุดุงุฑุฉ ุถุนููุฉ ุฌุฏุงู ๐จ - ุชุฌูุจ ุงูุชุฏุงูู"  # ูุฏ ููุณุฑ ูู 34% ุจูุงุกู ุนูู ุงููุทุงู ุงููุฐููุฑ ูู ุงูุชุนูููุงุช
    ]
    
    for i, text in enumerate(ai_texts, 1):
        print(f"\nูุซุงู {i}: {text}")
        
        # ูุญุงูุงุฉ ุงุณุชุฎุฑุงุฌ ูุณุจุฉ ุงูุซูุฉ
        confidence = extract_confidence_simulation(text)
        print(f"ูุณุจุฉ ุงูุซูุฉ ุงููุณุชุฎุฑุฌุฉ: {confidence}%")

def extract_confidence_simulation(text):
    """ูุญุงูุงุฉ ุงุณุชุฎุฑุงุฌ ูุณุจุฉ ุงูุซูุฉ ูู ุงููุต"""
    import re
    
    # ุงูุจุญุซ ุนู ุฃููุงุท ุงููุณุจ ุงููุฆููุฉ
    patterns = [
        r'ูุณุจุฉ\s+ุงููุฌุงุญ\s*:?\s*(\d+(?:\.\d+)?)%',
        r'ุงุญุชูุงููุฉ\s+ุงููุฌุงุญ\s*:?\s*(\d+(?:\.\d+)?)%',
        r'ูุนุฏู\s+ุงููุฌุงุญ\s*:?\s*(\d+(?:\.\d+)?)%',
        r'success\s+rate\s*:?\s*(\d+(?:\.\d+)?)%',
        r'(\d+(?:\.\d+)?)\s*%'  # ุฃู ูุณุจุฉ ูุฆููุฉ
    ]
    
    for pattern in patterns:
        matches = re.findall(pattern, text, re.IGNORECASE)
        if matches:
            try:
                rate = float(matches[-1])
                if 0 <= rate <= 100:
                    return rate
            except ValueError:
                continue
    
    # ุฅุฐุง ูู ูุฌุฏ ูุณุจุฉุ ูุฏ ูุณุชุฎุฏู ุงูุชุญููู ุงูุฐูู
    text_lower = text.lower()
    
    # ุงููููุงุช ุงูุฅูุฌุงุจูุฉ ูุงูุณูุจูุฉ
    positive_keywords = ['ุฅูุฌุงุจู', 'ุฌูุฏ', 'ููู', 'ููุชุงุฒ', 'ูุงุถุญ']
    negative_keywords = ['ุถุนูู', 'ุณูุจู', 'ูุฎุงุทุฑ', 'ุชุฌูุจ', 'ุณูุก']
    
    positive_count = sum(1 for keyword in positive_keywords if keyword in text_lower)
    negative_count = sum(1 for keyword in negative_keywords if keyword in text_lower)
    
    if positive_count > negative_count:
        return 55 + positive_count * 5  # ูุณุจุฉ ุฅูุฌุงุจูุฉ
    elif negative_count > positive_count:
        return max(45 - negative_count * 5, 15)  # ูุณุจุฉ ุณูุจูุฉ
    else:
        return 50  # ูุชูุณุท

def check_specific_34_percent_scenario():
    """ูุญุต ุงูุณููุงุฑูู ุงููุญุฏุฏ ุงูุฐู ูุคุฏู ุฅูู 34%"""
    print("\n๐ฏ ูุญุต ุงูุณููุงุฑูู ุงููุญุฏุฏ ูู 34%")
    print("=" * 40)
    
    # ุงูุณููุงุฑูู: AI ูุฑุฌุน ุชุญููู ุถุนูู ุจูุงุกู ุนูู ุงูุชุนูููุงุช
    ai_response = """
    ุจูุงุกู ุนูู ุงูุชุญููู ุงูููู:
    - ุงููุคุดุฑุงุช ูุชุถุงุฑุจุฉ
    - ุงูุงุชุฌุงู ุบูุฑ ูุงุถุญ
    - ูุฎุงุทุฑ ุนุงููุฉ
    - ุฅุดุงุฑุฉ ุถุนููุฉ ุฌุฏุงู
    
    ุงูุชูุตูุฉ: ุชุฌูุจ ุงูุชุฏุงูู
    ุงููุณุจุฉ: ูู ูุทุงู 20-34%
    """
    
    print(f"ูุต AI: {ai_response}")
    
    # ุงุณุชุฎุฑุงุฌ ุงููุณุจุฉ
    confidence = extract_confidence_simulation(ai_response)
    print(f"ูุณุจุฉ ุงูุซูุฉ ุงููุณุชุฎุฑุฌุฉ: {confidence}%")
    
    # ุฅุฐุง ูุงู ุงููุต ูุดูุฑ ุฅูู ูุทุงู 20-34%ุ ูุฏ ูุฎุชุงุฑ AI ุงููููุฉ 34%
    if "20-34%" in ai_response:
        print("โ๏ธ ุงููุต ูุญุชูู ุนูู ูุทุงู 20-34% - ูุฏ ููุณุฑ AI ูุฐุง ูู 34%")
        return 34.0
    
    return confidence

if __name__ == "__main__":
    simulate_ai_analysis_failure()
    simulate_confidence_extraction_issue()
    result = check_specific_34_percent_scenario()
    
    print(f"\n๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ: {result}%")
    print("\n๐ ุงูุชูุตูุงุช:")
    print("1. ูุญุต ุณุฌูุงุช AI ููุชุฃูุฏ ูู ููุน ุงูุงุณุชุฌุงุจุงุช")
    print("2. ุชุญุณูู ุงุณุชุฎุฑุงุฌ ูุณุจุฉ ุงูุซูุฉ ูู ูุตูุต AI")
    print("3. ุฅุถุงูุฉ ุขููุงุช ุงุญุชูุงุทูุฉ ุฃูุถู ุนูุฏ ูุดู AI")
    print("4. ูุฑุงุฌุนุฉ ุชุนูููุงุช AI ูุชุฌูุจ ุงูุชูุณูุฑ ุงูุฎุงุทุฆ ูููุทุงูุงุช")