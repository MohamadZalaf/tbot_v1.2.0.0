# دليل تشخيص مشاكل MetaTrader5 🔧

## 🚨 أدوات التشخيص الجديدة

### أوامر المطور المتاحة:
- `/mt5_debug` - تشخيص شامل لحالة MT5
- `/mt5_reconnect` - إعادة محاولة الاتصال يدوياً  
- `/clear_cache` - تنظيف الكاش يدوياً

---

## 🔍 خطوات التشخيص التدريجي

### 1. فحص التشخيص الأولي
```
/mt5_debug
```
سيُظهر لك:
- ✅/❌ حالة تثبيت MT5
- ✅/❌ حالة تهيئة MT5
- ✅/❌ معلومات الحساب
- ✅/❌ اختبار جلب البيانات
- ✅/❌ حالة اتصال البوت

### 2. الأسباب الشائعة للفشل

#### أ) MT5 غير مُثبت أو غير مُشغل
**الرسائل:**
- `❌ MT5 غير متاح`
- `خطأ في فحص إصدار MT5`

**الحلول:**
1. تأكد من تثبيت MetaTrader5
2. قم بتشغيل MT5
3. تأكد من أن MT5 يعمل في الخلفية

#### ب) لا يوجد اتصال بحساب
**الرسائل:**
- `❌ فشل في الحصول على معلومات الحساب`
- `لم يتم تسجيل الدخول لحساب في MT5`

**الحلول:**
1. افتح MT5 وسجل الدخول لحساب demo أو live
2. تأكد من نجاح الاتصال بالخادم
3. تأكد من صحة بيانات تسجيل الدخول

#### ج) التداول الآلي معطل
**الرسائل:**
- `التداول الآلي معطل في MT5`
- `TRADE_RETCODE_AUTOTRADING_DISABLED`

**الحلول:**
1. افتح MT5
2. اذهب إلى Tools → Options → Expert Advisors
3. فعّل "Allow automated trading"
4. فعّل "Allow DLL imports"

#### د) مشكلة في الاتصال بالخادم
**الرسائل:**
- `لا يوجد اتصال بالخادم`
- `انقطع الاتصال بالخادم`

**الحلول:**
1. تأكد من اتصال الإنترنت
2. جرب تغيير الخادم في MT5
3. أعد تشغيل MT5
4. تأكد من عدم حجب الفايرول لـ MT5

#### هـ) الرموز غير متاحة
**الرسائل:**
- `❌ فشل في جلب البيانات من جميع الرموز التجريبية`
- `السوق مغلق حالياً`

**الحلول:**
1. تحقق من أوقات عمل السوق
2. تأكد من أن الحساب يدعم الرموز المطلوبة
3. جرب رموز أخرى متاحة في حسابك

---

## ⚡ الحلول السريعة

### الحل السريع 1: إعادة الاتصال
```
/mt5_reconnect
```

### الحل السريع 2: تنظيف الكاش
```
/clear_cache
```

### الحل السريع 3: إعادة تشغيل كاملة
1. أغلق البوت
2. أغلق MT5
3. شغّل MT5 وسجل الدخول
4. شغّل البوت

---

## 📋 قائمة فحص MT5

### ✅ المتطلبات الأساسية:
- [ ] MT5 مُثبت ومُحدث
- [ ] MT5 يعمل في الخلفية
- [ ] تم تسجيل الدخول لحساب
- [ ] اتصال إنترنت مستقر
- [ ] "Allow automated trading" مُفعل

### ✅ فحص الحساب:
- [ ] حساب demo أو live نشط
- [ ] اتصال بالخادم ناجح
- [ ] بيانات اعتماد صحيحة
- [ ] رصيد متاح (للحساب الحقيقي)

### ✅ فحص البيانات:
- [ ] الرموز متاحة في الحساب
- [ ] أوقات السوق مناسبة
- [ ] تدفق البيانات يعمل

---

## 🔧 رموز الأخطاء الشائعة

| كود الخطأ | المعنى | الحل |
|-----------|--------|------|
| `RET_ERROR` | خطأ عام | إعادة تشغيل MT5 |
| `RET_TIMEOUT` | انتهت المهلة | تحسين الاتصال |
| `RET_NOT_FOUND` | عنصر غير موجود | تحقق من الرمز |
| `TRADE_RETCODE_CONNECTION` | لا يوجد اتصال | تحقق من الشبكة |
| `TRADE_RETCODE_AUTOTRADING_DISABLED` | التداول الآلي معطل | فعّل في الإعدادات |

---

## 📊 تحليل السجلات

### البحث في السجلات عن:
```
[ERROR] فشل في تهيئة MT5
[ACCOUNT_ISSUE] مشاكل محتملة
[DATA_WARNING] فشل في جلب البيانات
[TROUBLESHOOTING] أسباب محتملة
```

### مستويات التشخيص:
- `DEBUG`: تفاصيل دقيقة للتشخيص
- `INFO`: معلومات عامة
- `WARNING`: تحذيرات لا تمنع التشغيل
- `ERROR`: أخطاء تمنع التشغيل

---

## 🛠️ إعدادات MT5 المطلوبة

### في MT5:
1. **Tools → Options → Expert Advisors:**
   - ☑️ Allow automated trading
   - ☑️ Allow DLL imports
   - ☑️ Allow imports of external experts

2. **في نافذة Market Watch:**
   - أضف الرموز التي تريد تحليلها
   - تأكد من ظهور الأسعار

3. **في حالة VPS:**
   - تأكد من عمل MT5 24/7
   - تحقق من استقرار الاتصال

---

## 📞 الدعم والمساعدة

### عند الحاجة للمساعدة:
1. شغّل `/mt5_debug` وأرسل النتائج
2. ارفق آخر سجلات الأخطاء
3. اذكر نوع الحساب (demo/live) والوسيط
4. اذكر الرموز التي تحاول تحليلها

### معلومات مفيدة للتشخيص:
- إصدار MT5
- نوع نظام التشغيل
- الوسيط والخادم
- نوع الحساب
- الرموز المستخدمة

---

**💡 نصيحة:** استخدم أوامر التشخيص الجديدة بانتظام لمراقبة حالة النظام وحل المشاكل قبل تفاقمها!