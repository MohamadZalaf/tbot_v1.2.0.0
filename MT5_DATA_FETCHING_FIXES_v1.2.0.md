# Ø¥ØµÙ„Ø§Ø­Ø§Øª Ù…Ø´Ø§ÙƒÙ„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† MT5 ÙÙŠ Ø§Ù„Ø¨ÙˆØª v1.2.0

## ðŸ” Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§:

### 1. **Ù…Ø´ÙƒÙ„Ø© "Ø¨ÙŠØ§Ù†Ø§Øª MT5 Ù‚Ø¯ÙŠÙ…Ø©"**
```
[WARNING] Ø¨ÙŠØ§Ù†Ø§Øª MT5 Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø±Ù…Ø² XAUUSD (Ø¹Ù…Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: 20:11:59.802817)
[ERROR] ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† MT5 Ù„Ù„Ø±Ù…Ø² XAUUSD
```

### 2. **Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† `/mt5_debug` Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙØ§Ø´Ù„Ø©**
- `/mt5_debug` ÙŠØ¹Ù…Ù„ ÙˆÙŠØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­
- Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¢Ù„ÙŠØ©ØŒ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠØŒ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ØªÙØ´Ù„

## ðŸ› ï¸ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©:

### 1. **ØªØ¨Ø³ÙŠØ· Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´**
```python
# Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­
CACHE_DURATION = 10  # Ø«ÙˆØ§Ù†
@dataclass
class CachedPriceData:
    data: dict
    timestamp: datetime
    source: str  # Ù…Ø¹Ù‚Ø¯ ÙˆÙ…Ø³Ø¨Ø¨ Ù„Ù„Ù…Ø´Ø§ÙƒÙ„

# Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­  
CACHE_DURATION = 15  # Ø«ÙˆØ§Ù† - Ø£ÙƒØ«Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø±Ø§Ù‹
@dataclass
class CachedPriceData:
    data: dict
    timestamp: datetime
    # Ø¥Ø²Ø§Ù„Ø© source Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù†Ø¸Ø§Ù…
```

### 2. **Ø¥ØµÙ„Ø§Ø­ Ø¯Ø§Ù„Ø© `get_live_price`**
**Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:**
- Ø§Ø³ØªØ®Ø¯Ø§Ù… `connection_lock` Ù…Ù…Ø§ ÙŠØ³Ø¨Ø¨ deadlock
- Ø¹Ø¯Ù… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ù…ÙˆØ² Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
- Ø¹Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ù…ÙˆØ² Ø¨Ø¯ÙŠÙ„Ø©
- Ø¥Ø±Ø¬Ø§Ø¹ `None` ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

**Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª:**
```python
# Ø¥Ø¶Ø§ÙØ© ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…ÙˆØ² ÙˆØªÙØ¹ÙŠÙ„Ù‡Ø§
symbol_info = mt5.symbol_info(symbol)
if symbol_info is None:
    # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
    symbol_alternatives = {
        'XAUUSD': ['XAUUSD', 'GOLD', 'XAUUSD.m', 'GOLD.m', 'XAUUSD.c'],
        'EURUSD': ['EURUSD', 'EURUSD.m', 'EURUSD.c'],
        # ... Ø§Ù„Ù…Ø²ÙŠØ¯
    }

# ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø±Ù…Ø² Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
if not symbol_info.visible:
    mt5.symbol_select(symbol, True)
    time.sleep(0.5)  # Ø§Ù†ØªØ¸Ø§Ø± Ù„Ù„ØªÙØ¹ÙŠÙ„

# Ø¥Ø²Ø§Ù„Ø© connection_lock Ù„ØªØ¬Ù†Ø¨ deadlock
tick = mt5.symbol_info_tick(symbol)

# Ø§Ù†ØªØ¸Ø§Ø± Ø£Ø·ÙˆÙ„ Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
time.sleep(1)  # Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 0.5
```

### 3. **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©**
```python
# Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ NoneØŒ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
if time_diff.total_seconds() > 900:
    logger.warning(f"Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø© - Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ«...")
    time.sleep(0.2)
    fresh_tick = mt5.symbol_info_tick(symbol)
    if fresh_tick and fresh_tick.bid > 0:
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        tick = fresh_tick
        logger.info("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­")

# Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø§Ù„Ø¹Ù…Ø± (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† None)
data = {
    'symbol': symbol,
    'bid': tick.bid,
    'ask': tick.ask,
    'is_fresh': time_diff.total_seconds() <= 900  # Ø¹Ù„Ø§Ù…Ø© Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
}
```

### 4. **Ø­Ø°Ù Ø§Ù„Ø¯ÙˆØ§Ù„ ØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©**
- Ø­Ø°Ù `ensure_symbol_available()` - ÙƒØ§Ù†Øª Ù…Ø¹Ù‚Ø¯Ø© ÙˆØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
- Ø­Ø°Ù `calculate_spread_in_points()` - ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
- ØªØ¨Ø³ÙŠØ· Ø¯ÙˆØ§Ù„ Ø§Ù„ÙƒØ§Ø´

### 5. **ØªÙˆØ³ÙŠØ¹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©**
```python
symbol_alternatives = {
    # Ø§Ù„Ù…Ø¹Ø§Ø¯Ù† Ø§Ù„Ù†ÙÙŠØ³Ø©
    'XAUUSD': ['XAUUSD', 'GOLD', 'XAUUSD.m', 'GOLD.m', 'XAUUSD.c'],
    'XAGUSD': ['XAGUSD', 'SILVER', 'XAGUSD.m', 'SILVER.m'],
    
    # Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
    'BTCUSD': ['BTCUSD', 'BITCOIN', 'BTC', 'BTCUSD.m'],
    'ETHUSD': ['ETHUSD', 'ETHEREUM', 'ETH', 'ETHUSD.m'],
    
    # Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    'EURUSD': ['EURUSD', 'EURUSD.m', 'EURUSD.c'],
    'GBPUSD': ['GBPUSD', 'GBPUSD.m', 'GBPUSD.c'],
    
    # Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
    'US30': ['US30', 'US30.m', 'US30.c', 'DOW30'],
    'NAS100': ['NAS100', 'NAS100.m', 'NASDAQ'],
    
    # Ø§Ù„Ù†ÙØ·
    'USOIL': ['USOIL', 'CRUDE', 'WTI', 'USOIL.m']
}
```

## âœ… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:

### 1. **Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¢Ù„ÙŠØ©**
- Ø³ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¨Ø¯ÙˆÙ† Ø£Ø®Ø·Ø§Ø¡ "Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©"
- ØªÙØ¹ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø±Ù…ÙˆØ² ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù„Ø©
- Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…ÙˆØ² Ø¨Ø¯ÙŠÙ„Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø£ØµÙ„ÙŠ

### 2. **Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ**
- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† MT5
- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
- Ø¹Ø¯Ù… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©

### 3. **Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©**
- Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ù‚Ø¯ÙŠÙ…Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹
- ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø£ÙƒØ¨Ø± ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶

### 4. **Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©**
- ØªÙ‚Ù„ÙŠÙ„ Ø­Ø§Ù„Ø§Øª ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 80%+
- Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø£Ø³Ø±Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø£ÙƒØ¨Ø± ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…

## ðŸ”§ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©:

1. **Ø¥Ø²Ø§Ù„Ø© ØªØ¹Ù‚ÙŠØ¯Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´** - Ø¬Ø¹Ù„Ù‡ Ù…Ø«Ù„ v1.2.1
2. **Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ù†Ø·Ù‚ `/mt5_debug`** ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
3. **Ø¥Ø¶Ø§ÙØ© Ø¢Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©**
4. **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©**
5. **Ø¥Ø²Ø§Ù„Ø© deadlock Ø§Ù„Ù…Ø­ØªÙ…Ù„ Ù…Ù† `connection_lock`**

## ðŸ“‹ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª:

1. **ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª**: `python tbot_v1.2.0.py`
2. **Ø§Ø®ØªØ¨Ø§Ø± `/mt5_debug`**: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¹Ù…Ù„ ÙƒÙ…Ø§ ÙƒØ§Ù†
3. **Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¢Ù„ÙŠØ©**: Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© XAUUSD
4. **Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ**: ØªØ­Ù„ÙŠÙ„ EURUSD
5. **Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©**: Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµÙ„Ø§Ø­:** 2025-01-16  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø±:** v1.2.0 Fixed  
**Ø§Ù„Ù…Ø·ÙˆØ±:** ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ù‚Ø§Ø±Ù†Ø© Ù…Ø¹ v1.2.1 Ø§Ù„Ø¹Ø§Ù…Ù„