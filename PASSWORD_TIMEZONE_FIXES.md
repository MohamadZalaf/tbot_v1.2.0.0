# ุฅุตูุงุญ ูุดุงูู ูููุฉ ุงููุฑูุฑ ูุงูููุทูุฉ ุงูุฒูููุฉ

## 1. ูุดููุฉ ูููุฉ ุงููุฑูุฑ ๐

### ุงููุดููุฉ ุงูุฃุตููุฉ:
- ูููุฉ ุงููุฑูุฑ ุชูุทูุจ ููุท ุนูุฏ ุฃูุฑ `/start`
- โ ุงููุณุชุฎุฏููู ูููููู ุงููุตูู ูุฌููุน ุงููุธุงุฆู ุจุฏูู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ
- โ ุฅุฐุง ุฃุนุงุฏ ุงููุณุชุฎุฏู ุชุดุบูู ุงูุจูุชุ ููููู ุชุฌุงูุฒ ูููุฉ ุงููุฑูุฑ

### ุงูุญู ุงููุทุจู:
#### ุฃ) ุฅุถุงูุฉ ูุธุงู ูุตุงุฏูุฉ ุดุงูู:
```python
def is_user_authenticated(user_id: int) -> bool:
    """ุงูุชุญูู ูู ุฃู ุงููุณุชุฎุฏู ููุตุฑุญ ูู ุจุงููุตูู"""
    return user_sessions.get(user_id, {}).get('authenticated', False)

def require_authentication(func):
    """ุฏูููุฑูุชุฑ ููุชุญูู ูู ุงููุตุงุฏูุฉ ูุจู ุชูููุฐ ุงููุธููุฉ"""
    def wrapper(message_or_call):
        user_id = message_or_call.from_user.id
        
        if not is_user_authenticated(user_id):
            # ูุนุงูุฌุฉ callback queries
            if hasattr(message_or_call, 'message'):
                bot.answer_callback_query(
                    message_or_call.id, 
                    "๐ ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุฃููุงู ุจูุชุงุจุฉ /start", 
                    show_alert=True
                )
                return
            # ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงูุนุงุฏูุฉ
            else:
                bot.reply_to(
                    message_or_call, 
                    "๐ ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุฃููุงู ุจูุชุงุจุฉ /start"
                )
                return
        
        return func(message_or_call)
    return wrapper
```

#### ุจ) ุชุทุจูู ุงูุญูุงูุฉ ุนูู ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ:
```python
@bot.message_handler(func=lambda message: message.text == "๐ ุฃุณุนุงุฑ ูุจุงุดุฑุฉ")
@require_authentication
def handle_live_prices_keyboard(message):
    # ูุญูู ุจูููุฉ ุงููุฑูุฑ

@bot.callback_query_handler(func=lambda call: call.data == "live_prices")
@require_authentication
def handle_live_prices(call):
    # ูุญูู ุจูููุฉ ุงููุฑูุฑ

@bot.message_handler(func=lambda message: message.text == "๐ ุฅุญุตุงุฆูุงุชู")
@require_authentication
def handle_my_stats_keyboard(message):
    # ูุญูู ุจูููุฉ ุงููุฑูุฑ
```

### ุงููุชูุฌุฉ:
- โ **ุญูุงูุฉ ุดุงููุฉ:** ุฌููุน ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ ูุญููุฉ ุจูููุฉ ุงููุฑูุฑ
- โ **ุฑุณุงุฆู ูุงุถุญุฉ:** ุงููุณุชุฎุฏู ููุฎุจุฑ ุจูุถูุญ ุฃูู ูุญุชุงุฌ ูุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ
- โ **ุชุบุทูุฉ ูุงููุฉ:** ุชุนูู ูุน ุฃุฒุฑุงุฑ ุงูููุจูุฑุฏ ูุงูู inline buttons

## 2. ูุดููุฉ ุงูููุทูุฉ ุงูุฒูููุฉ ๐

### ุงููุดููุฉ ุงูุฃุตููุฉ:
- ุงูุฃููุงุช ูุง ุชุนูุณ ุงูููุทูุฉ ุงูุฒูููุฉ ุงููุฎุชุงุฑุฉ ูู ุงููุณุชุฎุฏู
- โ `datetime.now()` ูุณุชุฎุฏู ุงูููุช ุงููุญูู ููุฎุงุฏู
- โ ุนุฏู ุชุญููู ุตุญูุญ ูู UTC ุฅูู ููุทูุฉ ุงููุณุชุฎุฏู

### ุงูุญู ุงููุทุจู:
#### ุฃ) ุฅุตูุงุญ `format_time_for_user`:
```python
def format_time_for_user(user_id: int, timestamp: datetime = None) -> str:
    """ุชูุณูู ุงูููุช ุญุณุจ ุงูููุทูุฉ ุงูุฒูููุฉ ูููุณุชุฎุฏู ูุน ุนุฑุถ ุฌููู"""
    if timestamp is None:
        if TIMEZONE_AVAILABLE:
            timestamp = pytz.UTC.localize(datetime.utcnow())  # โ ุงุณุชุฎุฏุงู UTC
        else:
            timestamp = datetime.now()
    
    user_tz = get_user_timezone(user_id)
    
    if TIMEZONE_AVAILABLE:
        try:
            user_timezone = pytz.timezone(user_tz)
            
            # ุฅุฐุง ูุงู ุงูููุช ุจุฏูู timezoneุ ููุชุฑุถ ุฃูู UTC
            if timestamp.tzinfo is None:
                timestamp = pytz.UTC.localize(timestamp)
            
            # ุชุญููู ููููุทูุฉ ุงูุฒูููุฉ ูููุณุชุฎุฏู โ
            localized_time = timestamp.astimezone(user_timezone)
            
            # ุชูุณูู ุฌููู ููููุช ูุน ุงูุชุงุฑูุฎ
            formatted_time = localized_time.strftime('%Y-%m-%d %H:%M:%S')
            timezone_name = AVAILABLE_TIMEZONES.get(user_tz, user_tz)
            
            return f"๐ {formatted_time} ({timezone_name})"
        except Exception as e:
            logger.error(f"ุฎุทุฃ ูู ุชูุณูู ุงูููุช ูููุณุชุฎุฏู {user_id}: {e}")
    
    # ูู ุญุงูุฉ ุนุฏู ุชููุฑ pytz ุฃู ุญุฏูุซ ุฎุทุฃ
    formatted_time = timestamp.strftime('%Y-%m-%d %H:%M:%S')
    return f"๐ {formatted_time} (ุงูููุทูุฉ ุงููุญููุฉ)"
```

#### ุจ) ุฅุตูุงุญ `get_current_time_for_user`:
```python
def get_current_time_for_user(user_id: int) -> str:
    """ุงูุญุตูู ุนูู ุงูููุช ุงูุญุงูู ููุณู ูููุณุชุฎุฏู"""
    # ุงุณุชุฎุฏุงู UTC ุฃููุงู ุซู ุชุญููู ููููุทูุฉ ุงูุฒูููุฉ ูููุณุชุฎุฏู โ
    if TIMEZONE_AVAILABLE:
        try:
            utc_now = pytz.UTC.localize(datetime.now())
            return format_time_for_user(user_id, utc_now)
        except Exception as e:
            logger.error(f"ุฎุทุฃ ูู ุงูุญุตูู ุนูู ุงูููุช ุงูุญุงูู: {e}")
    
    return format_time_for_user(user_id, datetime.now())
```

### ุงููุชูุฌุฉ:
- โ **ุฃููุงุช ุตุญูุญุฉ:** ุฌููุน ุงูุฃููุงุช ุชุธูุฑ ุญุณุจ ุงูููุทูุฉ ุงูุฒูููุฉ ุงููุฎุชุงุฑุฉ
- โ **ุชุญููู ุฏููู:** ูู UTC ุฅูู ููุทูุฉ ุงููุณุชุฎุฏู
- โ **ุชุบุทูุฉ ุดุงููุฉ:** ุฌููุน ุงูุฑุณุงุฆู ุชุณุชุฎุฏู ุงููุธุงู ุงูุฌุฏูุฏ

## ุงูููุงุทู ุงูุฒูููุฉ ุงููุฏุนููุฉ ๐บ๏ธ

```python
AVAILABLE_TIMEZONES = {
    "Asia/Baghdad": "๐ฎ๐ถ ุจุบุฏุงุฏ (UTC+3)",
    "Asia/Riyadh": "๐ธ๐ฆ ุงูุฑูุงุถ (UTC+3)", 
    "Asia/Kuwait": "๐ฐ๐ผ ุงููููุช (UTC+3)",
    "Asia/Qatar": "๐ถ๐ฆ ุงูุฏูุญุฉ (UTC+3)",
    "Asia/Dubai": "๐ฆ๐ช ุฏุจู (UTC+4)",
    "Europe/Cairo": "๐ช๐ฌ ุงููุงูุฑุฉ (UTC+2)",
    "Europe/Istanbul": "๐น๐ท ุฅุณุชุทูุจูู (UTC+3)",
    "Europe/London": "๐ฌ๐ง ููุฏู (UTC+0)",
    "Europe/Berlin": "๐ฉ๐ช ุจุฑููู (UTC+1)",
    "America/New_York": "๐บ๐ธ ูููููุฑู (UTC-5)",
}
```

## ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญุงุช ๐งช

### ุงุฎุชุจุงุฑ ูููุฉ ุงููุฑูุฑ:
1. **ุฃุนุฏ ุชุดุบูู ุงูุจูุช** (ุฃู ุงุญุฐู ุจูุงูุงุช ุงููุณุชุฎุฏู)
2. **ุญุงูู ุงูุถุบุท ุนูู ุฃู ุฒุฑ** ุจุฏูู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ
3. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุฑุณุงูุฉ "๐ ูุฑุฌู ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุฃููุงู ุจูุชุงุจุฉ /start"

### ุงุฎุชุจุงุฑ ุงูููุทูุฉ ุงูุฒูููุฉ:
1. **ุงุฐูุจ ููุฅุนุฏุงุฏุงุช โ ุงูููุทูุฉ ุงูุฒูููุฉ**
2. **ุงุฎุชุฑ ููุทูุฉ ุฒูููุฉ ูุฎุชููุฉ** (ูุซู "๐ธ๐ฆ ุงูุฑูุงุถ")
3. **ุงุฐูุจ ููุฃุณุนุงุฑ ุงููุจุงุดุฑุฉ ุฃู ุงูุชุญููู**
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุงูููุช ูุธูุฑ ุญุณุจ ุงูููุทูุฉ ุงููุฎุชุงุฑุฉ

### ุฃูุซูุฉ ุนูู ุงููุชุงุฆุฌ:
**ูุจู ุงูุฅุตูุงุญ:**
```
๐ 2025-01-09 15:30:45 (UTC)  # โ ุฏุงุฆูุงู UTC
```

**ุจุนุฏ ุงูุฅุตูุงุญ:**
```
๐ 2025-01-09 18:30:45 (๐ธ๐ฆ ุงูุฑูุงุถ (UTC+3))  # โ ุญุณุจ ุงุฎุชูุงุฑ ุงููุณุชุฎุฏู
```

## ุงููุธุงุฆู ุงููุญููุฉ ุงูุขู ๐

- โ ุฒุฑ "๐ ุฃุณุนุงุฑ ูุจุงุดุฑุฉ" (ููุจูุฑุฏ)
- โ ุฒุฑ "๐ ุฅุญุตุงุฆูุงุชู" (ููุจูุฑุฏ)  
- โ ุฒุฑ "๐ ุงูุฃุณุนุงุฑ ุงููุจุงุดุฑุฉ" (inline)
- โ ุฌููุน ูุนุงูุฌุงุช ุงูุฃุณุนุงุฑ ูุงูุชุญููู

## ููุงุญุธุงุช ูููุฉ ๐

### ูููุฉ ุงููุฑูุฑ:
- ๐ **ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ:** `tra12345678` (ูู config.py)
- ๐ **ูููู ุชุบููุฑูุง** ูู ููู config.py
- ๐พ **ุงูุฌูุณุงุช ูุญููุธุฉ** ูู ุฐุงูุฑุฉ ุงูุจูุช (ุชููุณุญ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช)

### ุงูููุทูุฉ ุงูุฒูููุฉ:
- ๐ **ุงูุชุฑุงุถูุฉ:** ุจุบุฏุงุฏ (UTC+3)
- ๐ **ูุงุจูุฉ ููุชุฎุตูุต** ูู ุงูุฅุนุฏุงุฏุงุช
- ๐พ **ูุญููุธุฉ** ูู ุฐุงูุฑุฉ ุงูุจูุช

---
**ุญุงูุฉ ุงูุฅุตูุงุญ:** ููุชูู โ  
**ุงูุชุฃุซูุฑ:** ุญูุงูุฉ ุฃูููุฉ ูุนุฑุถ ุฃููุงุช ุตุญูุญุฉ  
**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 2025-01-09